---
description: "체크포인트 & 되돌리기 - 작업 저장점 관리 및 실수 복구"
alwaysApply: true
---

# 체크포인트 & 되돌리기 시스템

작업 저장점을 만들고, 필요시 이전 상태로 복구하는 통합 시스템입니다.

---

## 📋 핵심 원칙

1. **듀얼 트랙**: Git 프로젝트와 Non-Git 프로젝트 모두 지원
2. **솔직한 한계 인정**: AI의 실제 능력 범위 내에서만 약속
3. **안전 우선**: 위험한 명령어는 안내만, 직접 실행 안 함
4. **최소 개입**: 꼭 필요한 경우만 제안

---

## ⚠️ 중요: 현실적인 한계

```
┌─────────────────────────────────────────────────────────────┐
│                    솔직한 능력 범위                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ✅ 가능한 것:                                              │
│  ├── Git 프로젝트: git 명령어로 완전한 복구                 │
│  ├── 방금 한 작업 (1-2턴): 기억하고 되돌리기 가능           │
│  └── 변경 내용 기록: 뭘 바꿨는지 MD 파일로 기록             │
│                                                             │
│  ❌ 불가능한 것:                                            │
│  ├── Non-Git에서 "진정한" 파일 복구 (스냅샷 없음)           │
│  ├── 여러 세션에 걸친 복잡한 되돌리기                       │
│  └── A만 되돌리고 B,C,D 유지 (의존성 문제)                  │
│                                                             │
│  🟡 제한적으로 가능:                                        │
│  ├── Non-Git: 변경 기록 보고 "가이드" 제공 (수동 복구)      │
│  └── 같은 세션 내 이전 작업: 기록 있으면 시도 가능          │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 🎯 트리거

### 체크포인트 생성 트리거

다음 키워드 감지 시 체크포인트 생성:
- "체크포인트", "checkpoint", "저장해줘"
- "커밋해줘", "기록해줘", "스냅샷"

### 되돌리기 트리거

다음 키워드 감지 시 되돌리기 지원:
- "되돌려", "되돌리기", "undo", "restore"
- "취소", "원래대로", "방금 한 거 취소"

### 자동 제안 트리거 (최소화)

**제안하는 경우** (중요한 것만):
| 상황 | 이유 |
|------|------|
| 위험한 작업 전 | 삭제, DB 변경, 마이그레이션 등 |
| 핵심 기능 완성 | 마일스톤 달성 |
| 사용자 명시적 요청 | 당연히 |

**제안하지 않는 경우**:
- 단순 파일 수정
- 오타 수정
- 설정 파일 변경
- 30분마다 (피로감 유발)

---

## 📝 체크포인트 생성 프로세스

### Step 1: 환경 확인

```
프로젝트 루트에서:
1. .git 폴더 존재 확인
2. Git 프로젝트 → Git 커밋 + MD 기록
3. Non-Git 프로젝트 → MD 기록만 (한계 인정)
```

### Step 2: Git 프로젝트 (완전한 복구 가능)

```bash
# 1. 변경사항 확인
git status

# 2. 커밋 메시지 제안 (사용자 확인)
# [타입] 작업 요약

# 3. 사용자 확인 후 커밋
git add .
git commit -m "[타입] 작업 요약"

# 4. MD 기록도 생성 (검색용)
```

### Step 3: Non-Git 프로젝트 (가이드만 제공)

```markdown
⚠️ Non-Git 프로젝트 안내

Git이 없어서 완전한 복구는 어렵습니다.
대신 변경 내용을 기록해서 나중에 참고할 수 있게 합니다.

권장: 중요한 프로젝트는 git init으로 Git 초기화하세요.
```

### 커밋 메시지 형식

```
[타입] 작업 요약 (50자 이내)

상세 설명 (선택)

체크포인트: CP-YYYYMMDD-HHMMSS
```

| 타입 | 설명 |
|------|------|
| `feat` | 새 기능 |
| `fix` | 버그 수정 |
| `refactor` | 리팩토링 |
| `docs` | 문서 |
| `config` | 설정 |

---

## 🔄 되돌리기 프로세스

### Git 프로젝트 (권장)

```
되돌리기 요청 감지
    │
    ▼
"Git 프로젝트입니다. 어떻게 되돌릴까요?"
    │
    ├── 방금 한 커밋 → git revert HEAD
    ├── 특정 파일만 → git checkout HEAD -- [파일]
    └── 특정 시점으로 → git log 확인 후 선택
```

**안전한 복구 방법 (먼저 제안)**:
```bash
# 1. 단일 파일만 되돌리기 (안전)
git checkout HEAD -- path/to/file.ts

# 2. 임시 저장 후 되돌리기 (안전)
git stash
git checkout [커밋해시]
git stash pop  # 필요시 복원

# 3. 새 브랜치에서 복구 (안전)
git checkout -b restore-branch [커밋해시]
```

**위험한 명령어 (안내만, 직접 실행 안 함)**:
```
⚠️ 주의: 아래 명령어는 되돌릴 수 없습니다!

git reset --hard [커밋해시]
→ 커밋되지 않은 모든 변경사항이 영구 삭제됩니다.
→ 정말 필요하면 직접 타이핑하세요. AI가 실행하지 않습니다.
```

### Non-Git 프로젝트 (제한적)

```
되돌리기 요청 감지
    │
    ▼
"Non-Git 프로젝트입니다."
    │
    ├── 방금 한 작업 (1-2턴) → 기억하고 있으면 되돌리기 시도
    ├── 이전 작업 → 변경 기록 확인 후 가이드 제공
    └── 복잡한 되돌리기 → "Git 사용을 권장합니다" 안내
```

**Non-Git 안내 메시지**:
```markdown
🟡 Non-Git 프로젝트 되돌리기

완전한 파일 복구는 어렵습니다.

가능한 것:
- 방금 한 작업 (1-2턴): 되돌리기 시도
- 변경 기록 확인: !AGENT_System/ 로그 참조

권장:
- 중요한 프로젝트는 `git init`으로 Git 초기화
- 주요 작업마다 체크포인트 생성
```

---

## 📁 기록 저장

### 저장 위치

모든 기록은 `!AGENT_System/`에 통합 저장:

```
!AGENT_System/
├── YYYYMMDD_HHMMSS_CHECKPOINT_[요약].MD   # 체크포인트
├── YYYYMMDD_HHMMSS_RESTORE_[요약].MD      # 되돌리기 기록
└── YYYYMMDD_HHMMSS_LOG_system_*.MD        # 기존 로그
```

### 체크포인트 기록 형식

```markdown
---
type: checkpoint
id: CP-YYYYMMDD-HHMMSS
git_commit: [해시 또는 "non-git"]
---

# 체크포인트: [작업 요약]

## 변경 파일
- path/to/file1.ts (수정)
- path/to/file2.ts (생성)

## 작업 내용
[무엇을 했는지]

## 복구 방법
- Git: `git checkout [해시] -- [파일]`
- Non-Git: [가이드 또는 "완전 복구 불가"]
```

---

## 💬 사용 예시

### 체크포인트 생성

```
사용자: "체크포인트 만들어줘"

AI:
📍 체크포인트 생성

환경: Git 프로젝트 ✅

변경된 파일 (2개):
- src/auth/login.ts (수정)
- src/api/auth.ts (생성)

커밋 메시지 제안:
[feat] 로그인 API 연동

이대로 진행할까요?
```

### 되돌리기 (Git)

```
사용자: "방금 한 거 되돌려줘"

AI:
🔄 되돌리기

Git 프로젝트입니다. 안전하게 되돌릴 수 있습니다.

방금 변경한 파일:
- src/auth/login.ts

방법:
git checkout HEAD -- src/auth/login.ts

실행할까요?
```

### 되돌리기 (Non-Git)

```
사용자: "방금 한 거 되돌려줘"

AI:
🔄 되돌리기

Non-Git 프로젝트입니다.

방금 한 작업 (login.ts 수정)은 기억하고 있어서
되돌리기를 시도할 수 있습니다.

진행할까요?

💡 권장: 중요한 프로젝트는 `git init`으로 Git을 설정하세요.
```

---

## 🚫 하지 않는 것

1. **위험한 Git 명령어 직접 실행 안 함**
   - `git reset --hard` → 안내만
   - `git push --force` → 안내만

2. **과도한 자동 제안 안 함**
   - 단순 수정마다 제안 ❌
   - 30분마다 제안 ❌

3. **불가능한 약속 안 함**
   - Non-Git에서 "완전 복구" ❌
   - 여러 세션 걸친 복잡한 되돌리기 ❌
