---
description: "API ì„¤ê³„ ìŠ¤í‚¬ - RESTful API ë° ëª¨ë²” ì‚¬ë¡€"
globs: ["**/api/**", "**/routes/**", "**/controllers/**"]
alwaysApply: false
---

# API Design Skill

RESTful API ì„¤ê³„ ë° ëª¨ë²” ì‚¬ë¡€ ê°€ì´ë“œì…ë‹ˆë‹¤.

---

## ğŸ“‹ REST ì›ì¹™

### 1. ë¦¬ì†ŒìŠ¤ ê¸°ë°˜ URL

```
âœ… ì¢‹ìŒ: ë¦¬ì†ŒìŠ¤ ì¤‘ì‹¬
GET    /users           # ì‚¬ìš©ì ëª©ë¡
GET    /users/123       # íŠ¹ì • ì‚¬ìš©ì
POST   /users           # ì‚¬ìš©ì ìƒì„±
PUT    /users/123       # ì‚¬ìš©ì ì „ì²´ ìˆ˜ì •
PATCH  /users/123       # ì‚¬ìš©ì ë¶€ë¶„ ìˆ˜ì •
DELETE /users/123       # ì‚¬ìš©ì ì‚­ì œ

âŒ ë‚˜ì¨: ë™ì‚¬ ì¤‘ì‹¬
GET    /getUsers
POST   /createUser
POST   /deleteUser/123
```

### 2. ê³„ì¸µì  ë¦¬ì†ŒìŠ¤

```
âœ… ì¢‹ìŒ: ê³„ì¸µ í‘œí˜„
GET    /users/123/posts           # ì‚¬ìš©ìì˜ ê²Œì‹œê¸€
GET    /users/123/posts/456       # íŠ¹ì • ê²Œì‹œê¸€
GET    /posts/456/comments        # ê²Œì‹œê¸€ì˜ ëŒ“ê¸€

âš ï¸ ì£¼ì˜: ë„ˆë¬´ ê¹Šì€ ì¤‘ì²© í”¼í•˜ê¸° (3ë‹¨ê³„ ì´í•˜)
GET    /users/123/posts/456/comments/789/replies  # ë„ˆë¬´ ê¹ŠìŒ
GET    /comments/789/replies                      # ë” ë‚˜ìŒ
```

### 3. HTTP ë©”ì„œë“œ

| ë©”ì„œë“œ | ìš©ë„ | ë©±ë“±ì„± | ì•ˆì „ |
|--------|------|--------|------|
| GET | ì¡°íšŒ | âœ… | âœ… |
| POST | ìƒì„± | âŒ | âŒ |
| PUT | ì „ì²´ ìˆ˜ì • | âœ… | âŒ |
| PATCH | ë¶€ë¶„ ìˆ˜ì • | âŒ | âŒ |
| DELETE | ì‚­ì œ | âœ… | âŒ |

---

## ğŸ“‹ HTTP ìƒíƒœ ì½”ë“œ

### 1. ì„±ê³µ (2xx)

```
200 OK              # ì¼ë°˜ì ì¸ ì„±ê³µ
201 Created         # ë¦¬ì†ŒìŠ¤ ìƒì„± ì„±ê³µ
204 No Content      # ì„±ê³µ, ì‘ë‹µ ë³¸ë¬¸ ì—†ìŒ (DELETE)
```

### 2. í´ë¼ì´ì–¸íŠ¸ ì˜¤ë¥˜ (4xx)

```
400 Bad Request     # ì˜ëª»ëœ ìš”ì²­ í˜•ì‹
401 Unauthorized    # ì¸ì¦ í•„ìš”
403 Forbidden       # ê¶Œí•œ ì—†ìŒ (ì¸ì¦ì€ ë¨)
404 Not Found       # ë¦¬ì†ŒìŠ¤ ì—†ìŒ
409 Conflict        # ì¶©ëŒ (ì¤‘ë³µ ë“±)
422 Unprocessable   # ìœ íš¨ì„± ê²€ì¦ ì‹¤íŒ¨
429 Too Many Requests # ìš”ì²­ ì œí•œ ì´ˆê³¼
```

### 3. ì„œë²„ ì˜¤ë¥˜ (5xx)

```
500 Internal Server Error  # ì„œë²„ ì˜¤ë¥˜
502 Bad Gateway            # ê²Œì´íŠ¸ì›¨ì´ ì˜¤ë¥˜
503 Service Unavailable    # ì„œë¹„ìŠ¤ ë¶ˆê°€
504 Gateway Timeout        # íƒ€ì„ì•„ì›ƒ
```

---

## ğŸ“‹ ìš”ì²­/ì‘ë‹µ í˜•ì‹

### 1. ìš”ì²­ í˜•ì‹

```typescript
// POST /users
{
  "name": "John Doe",
  "email": "john@example.com",
  "role": "user"
}

// PATCH /users/123
{
  "name": "Jane Doe"  // ë³€ê²½í•  í•„ë“œë§Œ
}

// GET /users?page=1&limit=20&sort=createdAt&order=desc
```

### 2. ì„±ê³µ ì‘ë‹µ

```typescript
// ë‹¨ì¼ ë¦¬ì†ŒìŠ¤
{
  "data": {
    "id": "123",
    "name": "John Doe",
    "email": "john@example.com",
    "createdAt": "2024-01-15T10:30:00Z"
  }
}

// ëª©ë¡ (í˜ì´ì§€ë„¤ì´ì…˜)
{
  "data": [
    { "id": "1", "name": "User 1" },
    { "id": "2", "name": "User 2" }
  ],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 100,
    "totalPages": 5
  }
}

// ìƒì„± ì„±ê³µ (201)
{
  "data": {
    "id": "124",
    "name": "New User",
    ...
  },
  "message": "User created successfully"
}
```

### 3. ì˜¤ë¥˜ ì‘ë‹µ

```typescript
// ìœ íš¨ì„± ì˜¤ë¥˜ (422)
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Validation failed",
    "details": [
      {
        "field": "email",
        "message": "Invalid email format"
      },
      {
        "field": "password",
        "message": "Password must be at least 8 characters"
      }
    ]
  }
}

// ì¼ë°˜ ì˜¤ë¥˜ (400, 404 ë“±)
{
  "error": {
    "code": "USER_NOT_FOUND",
    "message": "User with ID 123 not found"
  }
}

// ì„œë²„ ì˜¤ë¥˜ (500)
{
  "error": {
    "code": "INTERNAL_ERROR",
    "message": "An unexpected error occurred",
    "requestId": "abc123"  // ë””ë²„ê¹…ìš©
  }
}
```

---

## ğŸ“‹ í˜ì´ì§€ë„¤ì´ì…˜

### 1. Offset ê¸°ë°˜

```
GET /users?page=2&limit=20

ì‘ë‹µ:
{
  "data": [...],
  "pagination": {
    "page": 2,
    "limit": 20,
    "total": 100,
    "totalPages": 5
  }
}
```

### 2. Cursor ê¸°ë°˜ (ê¶Œì¥ - ëŒ€ìš©ëŸ‰)

```
GET /users?cursor=abc123&limit=20

ì‘ë‹µ:
{
  "data": [...],
  "pagination": {
    "nextCursor": "def456",
    "hasMore": true
  }
}
```

---

## ğŸ“‹ í•„í„°ë§ & ì •ë ¬

### 1. í•„í„°ë§

```
GET /users?status=active
GET /users?role=admin&status=active
GET /users?createdAt[gte]=2024-01-01
GET /users?name[contains]=john
```

### 2. ì •ë ¬

```
GET /users?sort=createdAt&order=desc
GET /users?sort=-createdAt  # - ëŠ” ë‚´ë¦¼ì°¨ìˆœ
GET /users?sort=name,createdAt  # ë‹¤ì¤‘ ì •ë ¬
```

### 3. í•„ë“œ ì„ íƒ

```
GET /users?fields=id,name,email
GET /users/123?fields=id,name,posts.title
```

---

## ğŸ“‹ ì¸ì¦ & ë³´ì•ˆ

### 1. ì¸ì¦ í—¤ë”

```
Authorization: Bearer <access_token>
```

### 2. API í‚¤

```
X-API-Key: <api_key>
```

### 3. Rate Limiting í—¤ë”

```
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 95
X-RateLimit-Reset: 1640000000
```

---

## ğŸ“‹ ë²„ì „ ê´€ë¦¬

### 1. URL ê²½ë¡œ (ê¶Œì¥)

```
GET /v1/users
GET /v2/users
```

### 2. í—¤ë”

```
Accept: application/vnd.api+json; version=1
```

---

## ğŸ“‹ API êµ¬í˜„ ì˜ˆì‹œ

### Express.js

```typescript
// routes/users.ts
import { Router } from 'express';

const router = Router();

// GET /users
router.get('/', async (req, res) => {
  try {
    const { page = 1, limit = 20, sort = 'createdAt' } = req.query;
    const users = await userService.findAll({ page, limit, sort });
    res.json({ data: users.items, pagination: users.pagination });
  } catch (error) {
    res.status(500).json({
      error: { code: 'INTERNAL_ERROR', message: error.message }
    });
  }
});

// GET /users/:id
router.get('/:id', async (req, res) => {
  try {
    const user = await userService.findById(req.params.id);
    if (!user) {
      return res.status(404).json({
        error: { code: 'USER_NOT_FOUND', message: 'User not found' }
      });
    }
    res.json({ data: user });
  } catch (error) {
    res.status(500).json({
      error: { code: 'INTERNAL_ERROR', message: error.message }
    });
  }
});

// POST /users
router.post('/', validate(createUserSchema), async (req, res) => {
  try {
    const user = await userService.create(req.body);
    res.status(201).json({
      data: user,
      message: 'User created successfully'
    });
  } catch (error) {
    if (error.code === 'DUPLICATE_EMAIL') {
      return res.status(409).json({
        error: { code: 'DUPLICATE_EMAIL', message: 'Email already exists' }
      });
    }
    throw error;
  }
});
```

---

## ğŸ“‹ ì²´í¬ë¦¬ìŠ¤íŠ¸

```
URL ì„¤ê³„:
[ ] ë¦¬ì†ŒìŠ¤ ê¸°ë°˜ URLì¸ê°€?
[ ] ì ì ˆí•œ HTTP ë©”ì„œë“œ ì‚¬ìš©?
[ ] ê³„ì¸µì´ 3ë‹¨ê³„ ì´í•˜ì¸ê°€?

ì‘ë‹µ:
[ ] ì¼ê´€ëœ ì‘ë‹µ í˜•ì‹?
[ ] ì ì ˆí•œ ìƒíƒœ ì½”ë“œ?
[ ] ìœ ìš©í•œ ì˜¤ë¥˜ ë©”ì‹œì§€?

ê¸°ëŠ¥:
[ ] í˜ì´ì§€ë„¤ì´ì…˜ ì§€ì›?
[ ] í•„í„°ë§/ì •ë ¬ ì§€ì›?
[ ] Rate limiting ì ìš©?

ë³´ì•ˆ:
[ ] ì¸ì¦ ì ìš©?
[ ] ì…ë ¥ ê²€ì¦?
[ ] ì—ëŸ¬ ì •ë³´ ë…¸ì¶œ ì œí•œ?
```
