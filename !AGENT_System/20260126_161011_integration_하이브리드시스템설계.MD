# 하이브리드 시스템 설계서

**보고서 버전**: 20260126_161011
**보고자**: Integration Team
**설계 방식**: C (점진적 통합) → 나중에 A (완전 전환) 가능

---

## 🎯 설계 목표

### 핵심 원칙
1. **기존 강점 유지**: 에이전트 팀, 자동 로그, MCP 검증
2. **새 기능 추가**: Session Resume, Context Compress, Undo/Restore, Triggers 강화
3. **MDC 포맷 도입**: 경로별 규칙 지원
4. **점진적 전환**: 기존 시스템과 새 시스템 공존

---

## 📁 제안 폴더 구조

```
프로젝트 루트/
│
├── .cursorrules                    # 기존 유지 (Always 규칙으로 사용)
│
├── .cursor/
│   └── rules/                      # 새로운 MDC 규칙 (경로별)
│       │
│       ├── 00-core/                # 핵심 규칙 (Always)
│       │   ├── session-management.mdc    # 세션 관리 (NEW)
│       │   ├── context-compress.mdc      # 컨텍스트 압축 (NEW)
│       │   └── undo-restore.mdc          # 되돌리기 (NEW)
│       │
│       ├── 10-language/            # 언어별 규칙 (Auto - globs)
│       │   ├── typescript.mdc      # globs: ["**/*.ts"]
│       │   ├── react.mdc           # globs: ["**/*.tsx"]
│       │   └── python.mdc          # globs: ["**/*.py"]
│       │
│       ├── 20-skills/              # Agent Skills (Manual/Auto)
│       │   ├── react-best-practices.mdc  # Vercel 스킬
│       │   ├── code-review.mdc           # 코드 리뷰
│       │   └── tdd-workflow.mdc          # TDD
│       │
│       └── 30-project/             # 프로젝트 특화
│           └── cursor-research.mdc # 이 프로젝트 전용
│
├── _COMMAND_LIBRARY/               # 기존 유지
│
└── !AGENT_System/                  # 기존 유지 (자동 로그)
```

---

## 🔧 새로운 기능 설계

### 1. Session Management (세션 관리)

**목적**: Gemini CLI의 `/resume` 기능 참고, 대화 이어하기 지원

```yaml
# .cursor/rules/00-core/session-management.mdc
---
description: "세션 관리 - 대화 컨텍스트 유지 및 이어하기"
alwaysApply: true
---

# 세션 관리 규칙

## 세션 저장 트리거
다음 상황에서 현재 세션 상태를 요약하여 저장:
- 주요 작업 완료 시
- 사용자가 "저장", "세션 저장" 요청 시
- 1시간 이상 작업 진행 시

## 세션 저장 형식
저장 위치: `!AGENT_System/YYYYMMDD_HHMMSS_SESSION_세션명.MD`

내용:
- 현재 작업 상태
- 완료된 작업 목록
- 진행 중인 작업
- 다음 단계
- 관련 파일 링크

## 세션 복원 트리거
- 사용자가 "이어서", "계속", "resume" 요청 시
- 최근 세션 파일 검색 후 컨텍스트 복원

## 세션 복원 프로세스
1. `!AGENT_System/` 에서 최근 SESSION 파일 검색
2. 세션 내용 읽기
3. 컨텍스트 복원: "지난 세션에서 [작업]을 진행 중이었습니다. 이어서 진행할까요?"
```

### 2. Context Compress (컨텍스트 압축)

**목적**: Gemini CLI의 `/compress` 기능 참고, 토큰 절약

```yaml
# .cursor/rules/00-core/context-compress.mdc
---
description: "컨텍스트 압축 - 토큰 절약 및 효율적 대화 관리"
alwaysApply: true
---

# 컨텍스트 압축 규칙

## 압축 트리거
다음 상황에서 컨텍스트 압축 제안:
- 대화가 50턴 이상 진행 시
- 사용자가 "압축", "요약", "compress" 요청 시
- 컨텍스트 윈도우 70% 이상 사용 추정 시

## 압축 프로세스
1. 현재 대화의 핵심 내용 추출
2. 완료된 작업 요약
3. 진행 중인 작업 상태
4. 중요 결정사항 목록
5. 압축된 컨텍스트로 대화 재시작

## 압축 형식
```markdown
## 컨텍스트 압축 요약
- **프로젝트**: [프로젝트명]
- **완료**: [완료 작업 1줄 요약]
- **진행중**: [현재 작업]
- **결정사항**: [중요 결정들]
- **다음 단계**: [예정 작업]
```

## 압축 후
- 압축 요약을 새 대화의 시작점으로 사용
- 상세 내용은 !AGENT_System/에 로그로 저장
```

### 3. Undo/Restore (되돌리기)

**목적**: Gemini CLI의 `/restore` 기능 참고, 실수 복구

```yaml
# .cursor/rules/00-core/undo-restore.mdc
---
description: "되돌리기 - 파일 변경 복구 지원"
alwaysApply: true
---

# 되돌리기 규칙

## 변경 추적
파일 변경 시 자동으로 기록:
- 변경 전 상태 (스냅샷 개념)
- 변경 시각
- 변경 내용 요약
- 변경 이유

## 저장 위치
변경 기록: `!AGENT_System/YYYYMMDD_HHMMSS_LOG_system_파일변경.MD`

## 되돌리기 트리거
- 사용자가 "되돌려", "undo", "restore", "취소" 요청 시
- 에러 발생 후 복구 필요 시

## 되돌리기 프로세스
1. 최근 변경 기록 검색
2. 변경 목록 표시: "최근 변경사항: [파일1], [파일2]. 어떤 것을 되돌릴까요?"
3. 사용자 선택 후 복구 실행
4. 복구 로그 생성

## 되돌리기 범위
- 단일 파일 되돌리기
- 여러 파일 일괄 되돌리기
- 특정 시점으로 되돌리기

## 주의사항
- Git 커밋된 변경은 git revert 사용 안내
- 되돌리기 전 확인 필수
```

### 4. Triggers 강화 (트리거 시스템)

**목적**: Dust의 Triggers 기능 참고, 기존 트리거 시스템 보강

```yaml
# 기존 유저룰스의 트리거 시스템에 추가할 규칙

## 강화된 트리거 유형

### 1. 시간 기반 트리거 (기존 + 강화)
- 1시간 경과: 상태 요약 LOG 생성
- 작업 시작 시: 세션 시작 기록
- 작업 종료 시: 세션 저장

### 2. 이벤트 기반 트리거 (강화)
- PR 생성 요청 시 → 코드 리뷰 스킬 자동 적용
- 테스트 파일 생성 시 → TDD 워크플로우 제안
- 에러 발생 시 → 디버깅 에이전트 활성화

### 3. 파일 패턴 트리거 (NEW - MDC globs)
- *.tsx 편집 시 → React 규칙 자동 적용
- **/api/** 편집 시 → API 규칙 자동 적용
- *.test.* 편집 시 → 테스트 규칙 자동 적용

### 4. 누적 트리거 (기존 유지)
- 파일 변경 10개 누적 → 요약 LOG 생성
- 에러 3회 연속 → 디버깅 모드 제안
```

### 5. 역할 기반 에이전트 강화

**목적**: Roo Code의 역할 기반 에이전트 참고, 기존 에이전트 팀 보강

```yaml
# 기존 에이전트 팀에 역할 명확화 추가

## 강화된 역할 정의

### Architect (설계자) - 기존 Integration Team 강화
- 시스템 설계 결정
- 아키텍처 검토
- 기술 스택 결정

### Orchestrator (조율자) - 기존 PM Team 강화
- 작업 분배 및 조율
- 진행 상황 추적
- 팀 간 커뮤니케이션

### Coder (개발자) - 동적 생성 팀
- 실제 코드 작성
- 버그 수정
- 기능 구현

### QA (품질) - 기존 감사 Team 강화
- 코드 리뷰
- 테스트 작성
- 품질 검증

### Debugger (디버거) - NEW
- 에러 분석
- 원인 파악
- 해결책 제시

## 역할 전환 트리거
- "설계해줘" → Architect 활성화
- "구현해줘" → Coder 활성화
- "테스트해줘" → QA 활성화
- "에러 수정해줘" → Debugger 활성화
```

---

## 📋 MDC 규칙 템플릿

### Always 규칙 템플릿
```yaml
---
description: "규칙 설명 (AI가 읽고 판단)"
alwaysApply: true
---

# 규칙 제목

## 핵심 원칙
- 원칙 1
- 원칙 2

## 적용 규칙
- 규칙 1
- 규칙 2
```

### Auto (경로별) 규칙 템플릿
```yaml
---
description: "규칙 설명"
globs: ["**/*.tsx", "**/*.ts"]
alwaysApply: false
---

# 규칙 제목

## 적용 대상
이 규칙은 TypeScript/React 파일에만 적용됩니다.

## 규칙
- 규칙 1
- 규칙 2
```

### Manual 규칙 템플릿
```yaml
---
description: "수동 호출 규칙 - @규칙명으로 호출"
alwaysApply: false
---

# 규칙 제목 (Manual)

## 호출 방법
채팅에서 `@규칙명` 또는 `/규칙명`으로 호출

## 규칙 내용
- 내용 1
- 내용 2
```

---

## 🔄 마이그레이션 계획

### Phase 1: 현재 (점진적 통합)
```
1. 기존 .cursorrules 유지
2. .cursor/rules/ 폴더 생성
3. 새 기능 MDC 파일 추가
   - session-management.mdc
   - context-compress.mdc
   - undo-restore.mdc
4. 테스트 및 검증
```

### Phase 2: 안정화 후
```
1. 기존 유저룰스 중 일부를 MDC로 분리
2. 경로별 규칙 추가
3. Agent Skills 통합
```

### Phase 3: 새 프로젝트 (완전 전환)
```
1. 처음부터 MDC 기반 구조로 시작
2. .cursorrules 최소화 (핵심 원칙만)
3. 모든 규칙을 .cursor/rules/에 모듈화
```

---

## ✅ 즉시 생성할 파일 목록

| 파일 | 우선순위 | 상태 |
|------|----------|------|
| `.cursor/rules/00-core/session-management.mdc` | 🔴 높음 | 생성 예정 |
| `.cursor/rules/00-core/context-compress.mdc` | 🔴 높음 | 생성 예정 |
| `.cursor/rules/00-core/undo-restore.mdc` | 🟡 중간 | 생성 예정 |
| `.cursor/rules/20-skills/react-best-practices.mdc` | 🔴 높음 | 연구 후 생성 |
| 기존 유저룰스 트리거 강화 | 🟡 중간 | 업데이트 예정 |
| 에이전트 역할 강화 | 🟡 중간 | 업데이트 예정 |

---

## 📎 관련 파일 (종속관계)

- [20260126_151019_analysis_종합비교분석.MD](./20260126_151019_analysis_종합비교분석.MD) - 분석 보고서
- [AGENT_Teams.mdc](../.cursor/rules/AGENT_Teams.mdc) - 프로젝트 팀 설정
- [00_MASTER_RULES.md](../룰스모음/20251129_cursor-rules/00_MASTER_RULES.md) - 기존 마스터 룰스

## 🔗 버전 정보

- 설계서 버전: 20260126_161011
- 기반 분석: 20260126_151019
- 설계 방식: C (점진적 통합)
